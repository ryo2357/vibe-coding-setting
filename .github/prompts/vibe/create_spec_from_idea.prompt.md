---
mode: 'agent'
description: 'アイディアファイルから仕様書新規作成とプラン作成（初回実行用）'
---

このプロンプトは、`.kiro/specs/`ディレクトリが存在しない、または仕様書ファイルが存在しない初回実行時に、アイディアファイルから仕様書を新規作成し、プランを作成します。

## 実行手順

### フェーズ 1: アイディアファイル分析

1. **アイディア内容の把握**
   - アイディアファイルの概要と仕様を理解
   - 実現したい機能の詳細を抽出
   - 技術的な制約・要件を特定

2. **プロジェクト全体への位置づけ**
   - 既存機能との関係性を分析（既存コードベースを参照）
   - システム全体での役割を定義
   - 将来的な拡張性を考慮

### フェーズ 2: requirements.md新規作成

1. **プロジェクト名の取得**
   - ワークスペースのルートフォルダ名をプロジェクト名として使用
   - `.kiro/specs/<プロジェクト名>/`ディレクトリを作成

2. **プロジェクト概要の作成**
2. **プロジェクト概要の作成**
   - 既存システムの概要をまとめる
   - プロジェクトの目的・背景を記述
   - 主要な機能を整理

3. **新機能要件の作成**
   - アイディアをユーザーストーリー形式に変換
   - WHEN-THEN-SHALL形式での受け入れ基準作成
   - 要件の優先度設定

#### requirements.md構成テンプレート

```markdown
# 要件定義書

## はじめに

このドキュメントは、[プロジェクト名]の要件を定義します。[プロジェクトの概要・背景]

## 既存システム概要

[既存の機能・システムの説明]

## 要件

### 要件 1

**ユーザーストーリー:** [ユーザー種別]として、[実現したい機能]したい。これにより、[得られる価値・目的]。

#### 受け入れ基準

1. WHEN [条件・状況] THEN [システムの動作] SHALL
2. WHEN [条件・状況] THEN [システムの動作] SHALL

## 非機能要件

### パフォーマンス要件
- [レスポンス時間、処理能力等]

### セキュリティ要件
- [セキュリティに関する要件]

### 利用性要件
- [使いやすさ、アクセシビリティ等]
```

### フェーズ 3: design.md新規作成

1. **システムアーキテクチャの設計**
   - 既存コードベースのアーキテクチャを分析
   - 新機能を含むシステム全体設計
   - コンポーネント間の関係性を定義

2. **詳細設計の作成**
   - 新しいクラス・ウィジェットの設計
   - データ構造の定義
   - インターフェース設計
   - UI/UX設計

#### design.md構成テンプレート

```markdown
# 設計書

## 概要

[システムの技術的な全体像]

## アーキテクチャ

### 既存システム構造
[現在のアーキテクチャの説明]

### 新機能追加後の構造
[新機能を含めたシステム構造]

## コンポーネントとインターフェース

### [既存コンポーネント名]（既存）
**責務**: [コンポーネントの役割]
**継承**: [親クラス]
**主要メソッド**: [主要な機能]

### [新規コンポーネント名]（新規）

```dart
class NewComponent extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    // 実装内容
  }
}
```

**責務**: [コンポーネントの役割]
**継承**: [親クラス]
**依存**: [依存するクラス・パッケージ]

## データ構造

### [データモデル名]

```dart
class DataModel {
  final String property1;
  final int property2;
  
  DataModel({required this.property1, required this.property2});
}
```

## UI/UX設計

### 画面構成
[画面レイアウト・構成の説明]

### ユーザーインタラクション
[ユーザーの操作フローの説明]
```

### フェーズ 4: プラン作成

1. **実装計画の策定**
   - 新規作成した仕様書を踏まえた実装手順
   - 段階的実装のフェーズ分け
   - 各フェーズでの成果物と確認ポイント

2. **初回実装特有の考慮事項**
   - 既存コードベースとの統合方針
   - 段階的な機能追加計画
   - テスト・検証計画

## プランファイル構成テンプレート（初回用）

```markdown
# [機能名] 実装プラン（初回）

作成日: YYYY-MM-DD
参照アイディアファイル: .github/vibe/ideas/XXX_<機能名>.md

## 概要と目標

[アイディアの要約と実装目標]

## 仕様書新規作成状況

### requirements.md新規作成
- **作成内容**: [要件1, 要件2 等を新規作成]
- **既存システム分析**: [既存機能との関係性]
- **プロジェクト位置づけ**: [システム全体での役割]

### design.md新規作成
- **作成内容**: [新規コンポーネントA, アーキテクチャB 等を設計]
- **既存アーキテクチャ分析**: [現在の構造分析結果]
- **統合方針**: [既存システムとの統合計画]

## 実装手順

### フェーズ 1: 基盤整備
1. 必要な依存関係の追加（pubspec.yaml更新）
2. 基本的なデータモデル作成
3. **確認ポイント**: ビルド確認・基本構造テスト

### フェーズ 2: コア機能実装
1. 主要なビジネスロジック実装
2. データ処理機能の実装
3. **確認ポイント**: 単体テスト・ロジック動作確認

### フェーズ 3: UI実装
1. 画面・ウィジェット作成
2. ユーザーインタラクション実装
3. **確認ポイント**: UI表示確認・操作テスト

### フェーズ 4: 統合・最適化
1. 既存システムとの統合
2. パフォーマンス最適化
3. **確認ポイント**: 総合テスト・動作確認

## 品質保証

### requirements.md受け入れ基準確認
- [ ] 要件1の受け入れ基準1を満たす
- [ ] 要件1の受け入れ基準2を満たす

### design.md設計整合性確認
- [ ] 設計したアーキテクチャに従っている
- [ ] コンポーネント設計に沿っている

### 既存システム統合確認
- [ ] 既存機能に影響を与えていない
- [ ] 既存のコードスタイルに準拠している
- [ ] パフォーマンスへの悪影響がない

## 初回実装特有の注意点

1. **既存コードベース理解**: 既存の設計パターン・コーディング規約を把握
2. **段階的統合**: 既存システムへの影響を最小限に抑える実装順序
3. **テスト充実**: 新機能が既存機能に与える影響の検証を重視
4. **ドキュメント整備**: 今後の開発のための基盤ドキュメント作成
```

## 実行時の注意点

### 初回実行特有の考慮事項

1. **プロジェクト名取得**: ワークスペースのルートフォルダ名をプロジェクト名として使用
2. **既存プロジェクト分析**: コードベース・アーキテクチャの十分な理解
3. **既存機能の尊重**: 現在の設計パターン・コーディング規約の継承
4. **将来性考慮**: 今後の機能拡張を見据えた設計
5. **段階的アプローチ**: 既存システムへの影響を最小限に抑える実装

### ファイル作成順序

1. `.kiro/specs/<プロジェクト名>/requirements.md`
2. `.kiro/specs/<プロジェクト名>/design.md`
3. `.github/vibe/plans/XXX_<機能名>_implementation.md`

---

このプロンプトにより、仕様書が存在しない初回実行時でも、適切な仕様書作成からプラン作成まで一貫して実行できます。
