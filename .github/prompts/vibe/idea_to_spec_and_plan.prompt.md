---
mode: 'agent'
description: 'アイディアファイルから仕様書更新とプラン作成を一括実行'
---

このプロンプトは、新規のアイディアファイルから、requirements.md更新とプラン作成を一括で実行します。

## 実行手順

### フェーズ 1: アイディアファイル分析

1. **アイディア内容の把握**
   - アイディアファイルの概要と仕様を理解
   - 実現したい機能の詳細を抽出
   - 技術的な制約・要件を特定

2. **影響範囲の分析**
   - 既存機能への影響を予測
   - 必要な技術的変更を洗い出し
   - UI/UX変更の必要性を判定

### フェーズ 2: 仕様書参照・更新必要性判定

1. **既存仕様書の確認**
   - `.kiro/specs/<プロジェクト名>/requirements.md`を詳細に参照
   - `.kiro/specs/<プロジェクト名>/design.md`を詳細に参照
   - 既存の要件・設計パターンを理解

2. **更新必要性の判定**
   - **requirements.md更新判定**
     - 新機能が既存要件で対応できるか確認
     - 新しいユーザーストーリーが必要か判定
     - 既存の受け入れ基準への影響を分析
   
   - **design.md更新判定**
     - 既存アーキテクチャで実現可能か確認
     - 新しいコンポーネント・クラスが必要か判定
     - データ構造やインターフェースへの影響を分析

### フェーズ 3: requirements.md更新（必要な場合）

1. **新要件の作成**
   - アイディアをユーザーストーリー形式に変換
   - WHEN-THEN-SHALL形式での受け入れ基準作成
   - 適切な要件番号の割り当て

2. **既存要件の調整**
   - 関連する既存要件との整合性確保
   - 矛盾する要件の修正
   - 依存関係の明確化

#### 要件記述ガイドライン

```markdown
### 要件 X

**ユーザーストーリー:** [ユーザー種別]として、[実現したい機能]したい。これにより、[得られる価値・目的]。

#### 受け入れ基準

1. WHEN [条件・状況] THEN [システムの動作] SHALL
2. WHEN [条件・状況] THEN [システムの動作] SHALL
```

### フェーズ 4: design.md更新（必要な場合）

1. **アーキテクチャへの影響分析**
   - 既存コンポーネントの活用方針
   - 新規コンポーネントの追加計画
   - システム全体への影響範囲

2. **詳細設計の追加**
   - 新しいクラス・ウィジェットの設計
   - データ構造の拡張・変更
   - インターフェース設計
   - UI/UX設計の詳細

#### 設計記述ガイドライン

```markdown
### [コンポーネント名]（新規/拡張）

```dart
class ComponentName extends StatelessWidget {
  // クラス定義
}
```

**責務**: [コンポーネントの役割]
**継承**: [親クラス]
**依存**: [依存するクラス・パッケージ]
```

### フェーズ 5: プラン作成

1. **実装計画の策定**
   - 更新された仕様書を踏まえた実装手順
   - 段階的実装のフェーズ分け
   - 各フェーズでの成果物と確認ポイント

2. **品質保証計画**
   - requirements.mdの受け入れ基準との対応確認
   - design.mdの設計パターンとの整合性確認
   - テスト・動作確認計画

## プランファイル構成テンプレート

```markdown
# [機能名] 実装プラン

作成日: YYYY-MM-DD
参照アイディアファイル: .github/vibe/ideas/XXX_<機能名>.md

## 概要と目標

[アイディアの要約と実装目標]

## 仕様書参照・更新状況

### requirements.md
- **参照結果**: [要件X, 要件Y を参照]
- **更新内容**: [新規要件Z を追加 / 更新不要]
- **整合性**: [既存要件との関係性]

### design.md
- **参照結果**: [コンポーネントA, アーキテクチャB を参照]
- **更新内容**: [新規コンポーネントC を追加 / 更新不要]
- **影響範囲**: [変更が及ぶ範囲]

## 実装手順

### フェーズ 1: [フェーズ名]
1. [具体的なステップ]
2. [具体的なステップ]
3. **確認ポイント**: [ビルド確認・動作確認]

### フェーズ 2: [フェーズ名]
1. [具体的なステップ]
2. [具体的なステップ]
3. **確認ポイント**: [テスト・動作確認]

## 品質保証

### requirements.md受け入れ基準確認
- [ ] 要件Xの受け入れ基準1を満たす
- [ ] 要件Xの受け入れ基準2を満たす

### design.md設計整合性確認
- [ ] 既存アーキテクチャパターンに従っている
- [ ] コンポーネント設計に沿っている

### 既存機能への影響確認
- [ ] 既存機能の動作に問題がない
- [ ] パフォーマンスへの悪影響がない
```

## 実行時の注意点

1. **仕様書ファースト**: 必ず仕様書確認・更新を先に行う
2. **段階的更新**: requirements.md → design.md → プラン作成の順序を守る
3. **整合性維持**: 各フェーズで前段階との整合性を確認
4. **影響分析**: 既存システムへの影響を慎重に分析
5. **参照関係明記**: プランファイルで参照した仕様書セクションを明記

## プラン分割の判断基準

- 実装手順が5ステップを超える場合は分割を検討
- 複数の画面・コンポーネントにまたがる場合は分割
- ビルド・動作確認が複数回必要な場合は分割

### 分割時の構成例
- `XXX-01`: 基本設計・環境構築・初回ビルド確認
- `XXX-02`: コアデータモデル実装・単体テスト
- `XXX-03`: UI・画面表示機能・表示確認
- `XXX-04`: 操作・制御機能・操作テスト
- `XXX-05`: 拡張機能・最適化・総合テスト

---

このプロンプトにより、アイディアから仕様書更新、プラン作成まで一貫した品質保証プロセスを実現します。
